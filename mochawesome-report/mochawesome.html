<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mochawesome Report</title>
    <link rel="stylesheet" href="assets/app.css" />
  </head>
  <body
    data-raw='{"stats":{"suites":2,"tests":11,"passes":11,"pending":0,"failures":0,"start":"2026-01-20T13:14:10.796Z","end":"2026-01-20T13:14:17.174Z","duration":6378,"testsRegistered":11,"passPercent":100,"pendingPercent":0,"other":0,"hasOther":false,"skipped":0,"hasSkipped":false},"results":[{"uuid":"74e00ec3-83af-4af6-ad0b-54b1c323c4e0","title":"","fullFile":"","file":"","beforeHooks":[],"afterHooks":[],"tests":[],"suites":[{"uuid":"ebc400e3-e0a0-4e2d-a6e2-4dd4f7a85613","title":"anchor-vault-tests","fullFile":"/Users/qiaopengjun/Code/Solana/blueshift_anchor_vault/tests/anchor_vault.ts","file":"/tests/anchor_vault.ts","beforeHooks":[],"afterHooks":[],"tests":[{"title":"1. 成功存款 (Initial Deposit)","fullTitle":"anchor-vault-tests 1. 成功存款 (Initial Deposit)","timedOut":false,"duration":363,"state":"passed","speed":"slow","pass":true,"fail":false,"pending":false,"code":"__awaiter(void 0, void 0, void 0, function* () {\n        try {\n            yield program.methods\n                .deposit(oneSol)\n                .accounts({\n                signer: signer.publicKey,\n            })\n                .rpc();\n            const vaultBalance = yield provider.connection.getBalance(vaultPda);\n            (0, chai_1.expect)(vaultBalance).to.equal(oneSol.toNumber());\n        }\n        catch (err) {\n            console.error(\"Deposit error:\", err);\n            throw err;\n        }\n    })","err":{},"uuid":"be155e81-9630-415c-964a-68e983384b45","parentUUID":"ebc400e3-e0a0-4e2d-a6e2-4dd4f7a85613","isHook":false,"skipped":false},{"title":"2. 追加存款 (Top-up)","fullTitle":"anchor-vault-tests 2. 追加存款 (Top-up)","timedOut":false,"duration":458,"state":"passed","speed":"slow","pass":true,"fail":false,"pending":false,"code":"__awaiter(void 0, void 0, void 0, function* () {\n        const topUpAmount = new anchor.BN(0.5 * anchor.web3.LAMPORTS_PER_SOL);\n        yield program.methods\n            .deposit(topUpAmount)\n            .accounts({ signer: signer.publicKey })\n            .rpc();\n        const vaultBalance = yield provider.connection.getBalance(vaultPda);\n        (0, chai_1.expect)(vaultBalance).to.equal(oneSol.add(topUpAmount).toNumber());\n    })","err":{},"uuid":"032d1047-ef1c-4537-8d32-64d61728a1cb","parentUUID":"ebc400e3-e0a0-4e2d-a6e2-4dd4f7a85613","isHook":false,"skipped":false},{"title":"3. 提取部分资金 (Withdraw Partial)","fullTitle":"anchor-vault-tests 3. 提取部分资金 (Withdraw Partial)","timedOut":false,"duration":457,"state":"passed","speed":"slow","pass":true,"fail":false,"pending":false,"code":"__awaiter(void 0, void 0, void 0, function* () {\n        const withdrawAmount = new anchor.BN(0.8 * anchor.web3.LAMPORTS_PER_SOL);\n        yield program.methods\n            .withdraw(withdrawAmount)\n            .accounts({ signer: signer.publicKey })\n            .rpc();\n        const vaultBalance = yield provider.connection.getBalance(vaultPda);\n        // 1.5 - 0.8 = 0.7 SOL\n        (0, chai_1.expect)(vaultBalance).to.equal(0.7 * anchor.web3.LAMPORTS_PER_SOL);\n    })","err":{},"uuid":"66b60dfa-c98b-4430-8686-5287748605d8","parentUUID":"ebc400e3-e0a0-4e2d-a6e2-4dd4f7a85613","isHook":false,"skipped":false},{"title":"4. 尝试超额提款 (Should Fail)","fullTitle":"anchor-vault-tests 4. 尝试超额提款 (Should Fail)","timedOut":false,"duration":6,"state":"passed","speed":"fast","pass":true,"fail":false,"pending":false,"code":"__awaiter(void 0, void 0, void 0, function* () {\n        const excessiveAmount = new anchor.BN(10 * anchor.web3.LAMPORTS_PER_SOL);\n        try {\n            yield program.methods\n                .withdraw(excessiveAmount)\n                .accounts({ signer: signer.publicKey })\n                .rpc();\n            chai_1.expect.fail(\"应该报错：余额不足\");\n        }\n        catch (err) {\n            // 检查错误码是否符合合约定义的 InsufficientFunds\n            (0, chai_1.expect)(err.error.errorCode.code).to.equal(\"InsufficientFunds\");\n        }\n    })","err":{},"uuid":"43792cd3-9f96-4de6-9c61-2af1552896bc","parentUUID":"ebc400e3-e0a0-4e2d-a6e2-4dd4f7a85613","isHook":false,"skipped":false},{"title":"5. 尝试在有余额时关闭金库 (Should Fail)","fullTitle":"anchor-vault-tests 5. 尝试在有余额时关闭金库 (Should Fail)","timedOut":false,"duration":5,"state":"passed","speed":"fast","pass":true,"fail":false,"pending":false,"code":"__awaiter(void 0, void 0, void 0, function* () {\n        try {\n            yield program.methods\n                .close()\n                .accounts({ signer: signer.publicKey })\n                .rpc();\n            chai_1.expect.fail(\"应该报错：金库不为空\");\n        }\n        catch (err) {\n            (0, chai_1.expect)(err.error.errorCode.code).to.equal(\"VaultNotEmpty\");\n        }\n    })","err":{},"uuid":"a0d5dc37-b5e2-45ba-9132-01c55272ca41","parentUUID":"ebc400e3-e0a0-4e2d-a6e2-4dd4f7a85613","isHook":false,"skipped":false},{"title":"6. 清空资金并关闭金库 (Final Cleanup)","fullTitle":"anchor-vault-tests 6. 清空资金并关闭金库 (Final Cleanup)","timedOut":false,"duration":914,"state":"passed","speed":"slow","pass":true,"fail":false,"pending":false,"code":"__awaiter(void 0, void 0, void 0, function* () {\n        // 1. 获取当前剩余所有余额并取出\n        const currentBalance = yield provider.connection.getBalance(vaultPda);\n        yield program.methods\n            .withdraw(new anchor.BN(currentBalance))\n            .accounts({ signer: signer.publicKey })\n            .rpc();\n        // 2. 调用 close 销毁 state 账户\n        const tx = yield program.methods\n            .close()\n            .accounts({ signer: signer.publicKey })\n            .rpc();\n        // 3. 验证 state 账户已被销毁 (AccountInfo 为 null)\n        const stateInfo = yield provider.connection.getAccountInfo(statePda);\n        (0, chai_1.expect)(stateInfo).to.be.null;\n        console.log(\"Vault closed and rent reclaimed. Signature:\", tx);\n    })","err":{},"uuid":"f2b505c4-3f18-4692-b8a1-483794f2ed4f","parentUUID":"ebc400e3-e0a0-4e2d-a6e2-4dd4f7a85613","isHook":false,"skipped":false}],"suites":[],"passes":["be155e81-9630-415c-964a-68e983384b45","032d1047-ef1c-4537-8d32-64d61728a1cb","66b60dfa-c98b-4430-8686-5287748605d8","43792cd3-9f96-4de6-9c61-2af1552896bc","a0d5dc37-b5e2-45ba-9132-01c55272ca41","f2b505c4-3f18-4692-b8a1-483794f2ed4f"],"failures":[],"pending":[],"skipped":[],"duration":2203,"root":false,"rootEmpty":false,"_timeout":1000000},{"uuid":"0c8ab99f-ba81-4a1a-8f64-109260a085c2","title":"blueshift_anchor_vault","fullFile":"/Users/qiaopengjun/Code/Solana/blueshift_anchor_vault/tests/blueshift_anchor_vault.ts","file":"/tests/blueshift_anchor_vault.ts","beforeHooks":[],"afterHooks":[],"tests":[{"title":"Deposit: Successfully deposits to empty vault","fullTitle":"blueshift_anchor_vault Deposit: Successfully deposits to empty vault","timedOut":false,"duration":932,"state":"passed","speed":"slow","pass":true,"fail":false,"pending":false,"code":"__awaiter(void 0, void 0, void 0, function* () {\n        const signer = yield createFundedKeypair();\n        const [vaultPDA] = getVaultPDA(signer.publicKey);\n        const depositAmount = new anchor.BN(1 * LAMPORTS_PER_SOL);\n        // Get initial balances\n        const initialSignerBalance = yield provider.connection.getBalance(signer.publicKey);\n        const initialVaultBalance = yield provider.connection.getBalance(vaultPDA);\n        // Deposit - Anchor automatically resolves the vault PDA\n        const tx = yield program.methods\n            .deposit(depositAmount)\n            .accounts({\n            signer: signer.publicKey,\n        })\n            .signers([signer])\n            .rpc();\n        console.log(\"Deposit transaction signature:\", tx);\n        // Verify balances\n        const finalSignerBalance = yield provider.connection.getBalance(signer.publicKey);\n        const finalVaultBalance = yield provider.connection.getBalance(vaultPDA);\n        // Vault should receive exactly the deposit amount\n        (0, chai_1.expect)(finalVaultBalance - initialVaultBalance).to.equal(depositAmount.toNumber());\n        // Signer should lose at least the deposit amount (may be more due to transaction fees)\n        (0, chai_1.expect)(initialSignerBalance - finalSignerBalance).to.be.at.least(depositAmount.toNumber());\n    })","err":{},"uuid":"4d6c3826-fba7-49d0-a560-b7bf1c9997a8","parentUUID":"0c8ab99f-ba81-4a1a-8f64-109260a085c2","isHook":false,"skipped":false},{"title":"Deposit: Fails when vault already has funds","fullTitle":"blueshift_anchor_vault Deposit: Fails when vault already has funds","timedOut":false,"duration":935,"state":"passed","speed":"slow","pass":true,"fail":false,"pending":false,"code":"__awaiter(void 0, void 0, void 0, function* () {\n        const signer = yield createFundedKeypair();\n        const [vaultPDA] = getVaultPDA(signer.publicKey);\n        const depositAmount = new anchor.BN(1 * LAMPORTS_PER_SOL);\n        // First deposit should succeed\n        yield program.methods\n            .deposit(depositAmount)\n            .accounts({\n            signer: signer.publicKey,\n        })\n            .signers([signer])\n            .rpc();\n        // Second deposit should fail\n        try {\n            yield program.methods\n                .deposit(depositAmount)\n                .accounts({\n                signer: signer.publicKey,\n            })\n                .signers([signer])\n                .rpc();\n            chai_1.expect.fail(\"Should have thrown an error\");\n        }\n        catch (err) {\n            (0, chai_1.expect)(err.error.errorMessage).to.equal(\"Vault already exists\");\n        }\n    })","err":{},"uuid":"002da313-c074-49cf-8609-945b0a52614e","parentUUID":"0c8ab99f-ba81-4a1a-8f64-109260a085c2","isHook":false,"skipped":false},{"title":"Deposit: Fails when amount is too small","fullTitle":"blueshift_anchor_vault Deposit: Fails when amount is too small","timedOut":false,"duration":460,"state":"passed","speed":"slow","pass":true,"fail":false,"pending":false,"code":"__awaiter(void 0, void 0, void 0, function* () {\n        const signer = yield createFundedKeypair();\n        const [vaultPDA] = getVaultPDA(signer.publicKey);\n        // Try to deposit a very small amount (less than rent-exempt minimum)\n        const smallAmount = new anchor.BN(1000); // 1000 lamports\n        try {\n            yield program.methods\n                .deposit(smallAmount)\n                .accounts({\n                signer: signer.publicKey,\n            })\n                .signers([signer])\n                .rpc();\n            chai_1.expect.fail(\"Should have thrown an error\");\n        }\n        catch (err) {\n            (0, chai_1.expect)(err.error.errorMessage).to.equal(\"Invalid amount\");\n        }\n    })","err":{},"uuid":"24e7e087-b641-4579-b6cd-59760d942fd0","parentUUID":"0c8ab99f-ba81-4a1a-8f64-109260a085c2","isHook":false,"skipped":false},{"title":"Withdraw: Successfully withdraws all funds from vault","fullTitle":"blueshift_anchor_vault Withdraw: Successfully withdraws all funds from vault","timedOut":false,"duration":1384,"state":"passed","speed":"slow","pass":true,"fail":false,"pending":false,"code":"__awaiter(void 0, void 0, void 0, function* () {\n        const signer = yield createFundedKeypair();\n        const [vaultPDA] = getVaultPDA(signer.publicKey);\n        const depositAmount = new anchor.BN(1 * LAMPORTS_PER_SOL);\n        // First, deposit some funds\n        yield program.methods\n            .deposit(depositAmount)\n            .accounts({\n            signer: signer.publicKey,\n        })\n            .signers([signer])\n            .rpc();\n        // Get balances before withdrawal\n        const beforeWithdrawSignerBalance = yield provider.connection.getBalance(signer.publicKey);\n        const beforeWithdrawVaultBalance = yield provider.connection.getBalance(vaultPDA);\n        // Withdraw\n        const tx = yield program.methods\n            .withdraw()\n            .accounts({\n            signer: signer.publicKey,\n        })\n            .signers([signer])\n            .rpc();\n        console.log(\"Withdraw transaction signature:\", tx);\n        // Verify balances\n        const afterWithdrawSignerBalance = yield provider.connection.getBalance(signer.publicKey);\n        const afterWithdrawVaultBalance = yield provider.connection.getBalance(vaultPDA);\n        (0, chai_1.expect)(afterWithdrawVaultBalance).to.equal(0);\n        (0, chai_1.expect)(afterWithdrawSignerBalance).to.be.greaterThan(beforeWithdrawSignerBalance);\n        // The signer should receive the vault balance minus transaction fees\n        (0, chai_1.expect)(afterWithdrawSignerBalance - beforeWithdrawSignerBalance).to.be.closeTo(beforeWithdrawVaultBalance, 0.01 * LAMPORTS_PER_SOL);\n    })","err":{},"uuid":"fef0ee52-7d80-4060-b06b-4fd7b328998b","parentUUID":"0c8ab99f-ba81-4a1a-8f64-109260a085c2","isHook":false,"skipped":false},{"title":"Withdraw: Fails when vault is empty","fullTitle":"blueshift_anchor_vault Withdraw: Fails when vault is empty","timedOut":false,"duration":463,"state":"passed","speed":"slow","pass":true,"fail":false,"pending":false,"code":"__awaiter(void 0, void 0, void 0, function* () {\n        const signer = yield createFundedKeypair();\n        const [vaultPDA] = getVaultPDA(signer.publicKey);\n        // Ensure vault is empty (new keypair, so vault should be empty)\n        const vaultBalance = yield provider.connection.getBalance(vaultPDA);\n        (0, chai_1.expect)(vaultBalance).to.equal(0);\n        // Try to withdraw from empty vault\n        try {\n            yield program.methods\n                .withdraw()\n                .accounts({\n                signer: signer.publicKey,\n            })\n                .signers([signer])\n                .rpc();\n            chai_1.expect.fail(\"Should have thrown an error\");\n        }\n        catch (err) {\n            (0, chai_1.expect)(err.error.errorMessage).to.equal(\"Invalid amount\");\n        }\n    })","err":{},"uuid":"a4b42700-c11a-4d2c-b6bc-9089b2b31868","parentUUID":"0c8ab99f-ba81-4a1a-8f64-109260a085c2","isHook":false,"skipped":false}],"suites":[],"passes":["4d6c3826-fba7-49d0-a560-b7bf1c9997a8","002da313-c074-49cf-8609-945b0a52614e","24e7e087-b641-4579-b6cd-59760d942fd0","fef0ee52-7d80-4060-b06b-4fd7b328998b","a4b42700-c11a-4d2c-b6bc-9089b2b31868"],"failures":[],"pending":[],"skipped":[],"duration":4174,"root":false,"rootEmpty":false,"_timeout":1000000}],"passes":[],"failures":[],"pending":[],"skipped":[],"duration":0,"root":true,"rootEmpty":true,"_timeout":1000000}],"meta":{"mocha":{"version":"9.2.2"},"mochawesome":{"options":{"quiet":false,"reportFilename":"mochawesome","saveHtml":true,"saveJson":true,"consoleReporter":"spec","useInlineDiffs":false,"code":true},"version":"7.1.4"},"marge":{"version":"6.3.2"}}}'
    data-config='{"reportFilename":"mochawesome","reportDir":"mochawesome-report","reportTitle":"blueshift_anchor_vault","reportPageTitle":"Mochawesome Report","inline":false,"inlineAssets":false,"cdn":false,"charts":false,"enableCharts":false,"code":true,"enableCode":true,"autoOpen":false,"overwrite":true,"timestamp":false,"ts":false,"showPassed":true,"showFailed":true,"showPending":true,"showSkipped":false,"showHooks":"failed","saveJson":true,"saveHtml":true,"dev":false,"assetsDir":"mochawesome-report/assets","jsonFile":"/Users/qiaopengjun/Code/Solana/blueshift_anchor_vault/mochawesome-report/mochawesome.json","htmlFile":"/Users/qiaopengjun/Code/Solana/blueshift_anchor_vault/mochawesome-report/mochawesome.html"}'
  >
    <div id="report"></div>
    <script src="assets/app.js"></script>
  </body>
</html>
